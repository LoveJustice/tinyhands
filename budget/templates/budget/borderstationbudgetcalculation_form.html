{% extends 'base.html' %}
{% load widget_tweaks %}
{% load bootstrap %}
{% load humanize %}
{% load unslugify %}




{% block title %}Budget Calculation{% endblock %}

{% block tab_block %}
    {% block content %}
        <script type="text/javascript" src="http://knockoutjs.com/downloads/knockout-3.2.0.js"></script>

     <h1 style="font-size: 25px; text-align: center">Tiny Hands Nepal - Border Monitoring Station Budget Calculation Form</h1>

     <form id="budget-calc-form" method="post">
        {% csrf_token %}

        <div class="form-page">
            <div class="row">
                <div class="col-md-4">
                    Station Name: {{ form.instance.border_station.station_name }} ({{ form.instance.border_station.station_code }})
                    {{ form.border_station|bootstrap }}
                </div>

                <div class="col-md-2">
                    Date Submitted: {{ form.instance.date_time_entered|date:"D. M. Y."}}
                </div>

                <div class="col-md-4 col-md-offset-7">
                    <table class="table table-striped table-bordered table-hover">
                        <thead>
                            <tr>
                                <th>   </th>
                                <th class="text-center">INT</th>
                                <th class="text-center">$/INT</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>Last Month</td>
                                <td></td>
                                <td></td>
                            </tr>
                            <tr>
                                <td>Last 3 Months</td>
                                <td></td>
                                <td></td>
                            </tr>
                            <tr>
                                <td>All Time</td>
                                <td></td>
                                <td></td>
                            </tr>
                            <tr>
                                <td># of Staff</td>
                                <td colspan="2"></td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <div class="row">
                <div class="col-md-6">
                    <h2 class="background"><span>Staff Salaries</span></h2>
                    We need to render this from the static station model

                    {{ form2 }}

                </div>
                <div class="col-md-6">
                    <h2 class="background"><span>Shelter</span></h2>
                    {{ form.shelter_rent|attr:"data-bind:value: shelterRent"|bootstrap }}
                    {{ form.shelter_water|attr:"data-bind:value: shelterWater"|bootstrap }}
                    {{ form.shelter_electricity|attr:"data-bind:value: shelterElectricity"|bootstrap }}
                    {{ form.shelter_shelter_startup|attr:"data-bind:checked: shelterStartupBool"|bootstrap }}
                    {{ form.shelter_shelter_startup_amount|attr:"data-bind:value: shelterStartupAmount"|bootstrap }}
                    {{ form.shelter_shelter_two|attr:"data-bind:checked: shelterTwoBool"|bootstrap }}
                    {{ form.shelter_shelter_two_amount|attr:"data-bind:value: shelterTwoAmount"|bootstrap }}

                    <label>Shelter Checkbox Total</label>
                    <p>The checkbox total is <span data-bind="text: shelterCheckboxTotal"></span><br/></p>

                    <label for="shelterTotal">Shelter TOTAL</label>
                    <p>The total is <span data-bind="text: shelterTotal"></span><p/>
                </div>

            </div>

            <div class="row">
                <div class="col-md-6">
                    <h2 class="background"><span>Communication</span></h2>
                    {{ form.communication_chair|attr:"data-bind:checked: commChairBool"|bootstrap }}
                    {{ form.communication_chair_amount|attr:"data-bind:value: commChairAmount"|bootstrap }}
                    {{ form.communication_manager|attr:"data-bind:checked: commManagerBool"|bootstrap }}
                    {{ form.communication_manager_amount|attr:"data-bind:value: commManagerAmount"|bootstrap }}
                    {{ form.communication_number_of_staff_with_walkie_talkies|attr:"data-bind:value: commNumberOfStaffWt"|bootstrap }}
                    {{ form.communication_number_of_staff_with_walkie_talkies_multiplier|attr:"data-bind:value: commNumberOfStaffWtMultiplier"|bootstrap }}
                    {{ form.communication_each_staff|attr:"data-bind:value: commEachStaffWt"|bootstrap }}
                    {{ form.communication_each_staff_multiplier|attr:"data-bind:value: commEachStaffWtMultiplier"|bootstrap }}
                    <label>TOTAL COMM</label>
                    <p>The total is <span data-bind="text: commTotal"></span><br/></p>
                </div>
                <div class="col-md-6">
                    <h2 class="background"><span>Food & Gas</span></h2>
                    {{ form.food_and_gas_number_of_intercepted_girls|attr:"data-bind:value: foodGasNumberOfGirls"|bootstrap }}
                    {{ form.food_and_gas_number_of_intercepted_girls_multiplier_before|attr:"data-bind:value: foodGasMultiplierBefore"|bootstrap }}
                    {{ form.food_and_gas_number_of_intercepted_girls_multiplier_after|attr:"data-bind:value: foodGasMultiplierAfter"|bootstrap }}
                    {{ form.food_and_gas_limbo_girls_multiplier|attr:"data-bind:value: limboMultiplier"|bootstrap }}
                    {{ form.food_and_gas_number_of_limbo_girls|attr:"data-bind:value: limboNumberOfGirls"|bootstrap }}
                    {{ form.food_and_gas_number_of_days|attr:"data-bind:value: limboNumberOfDays"|bootstrap }}

                    <label>Intercepted TOTAL</label>
                    <p>The total is <span data-bind="text: foodGasInterceptedGirls"></span><br/></p>

                    <label>Intercepted TOTAL</label>
                    <p>The total is <span data-bind="text: foodGasLimboGirls"></span><br/></p>

                    <label>TOTAL FOOD</label>
                    <p>The total is <span data-bind="text: foodTotal"></span><br/></p>


                    <h2 class="background"><span>Awareness</span></h2>
                    {{ form.awareness_contact_cards|bootstrap }}
                    {{ form.awareness_contact_cards_boolean_amount|bootstrap }}
                    {{ form.awareness_contact_cards_amount|bootstrap }}
                    {{ form.awareness_awareness_party_boolean|bootstrap }}
                    {{ form.awareness_awareness_party|bootstrap }}
                    {{ form.awareness_sign_boards_boolean|bootstrap }}
                    {{ form.awareness_sign_boards|bootstrap }}


                </div>
            </div>

            <div class="row">
                <div class="col-md-6">
                    <h2 class="background"><span>Travel</span></h2>
                    {{ form.travel_chair_with_bike|bootstrap }}
                    {{ form.travel_chair_with_bike_amount|bootstrap }}
                    {{ form.travel_manager_with_bike|bootstrap }}
                    {{ form.travel_manager_with_bike_amount|bootstrap }}
                    {{ form.travel_number_of_staff_using_bikes|bootstrap }}
                    {{ form.travel_number_of_staff_using_bikes_multiplier|bootstrap }}
                    {{ form.travel_last_months_expense_for_sending_girls_home|bootstrap }}
                    {{ form.travel_motorbike|bootstrap }}
                    {{ form.travel_motorbike_amount|bootstrap }}
                    {{ form.travel_plus_other|bootstrap }}
                </div>

                <div class="col-md-6">
                    <h2 class="background"><span>Supplies</span></h2>
                    {{ form.supplies_walkie_talkies_boolean|bootstrap }}
                    {{ form.supplies_walkie_talkies_amount|bootstrap }}
                    {{ form.supplies_recorders_boolean|bootstrap }}
                    {{ form.supplies_recorders_amount|bootstrap }}
                    {{ form.supplies_binoculars_boolean|bootstrap }}
                    {{ form.supplies_binoculars_amount|bootstrap }}
                    {{ form.supplies_flashlights_boolean|bootstrap }}
                    {{ form.supplies_flashlights_amount|bootstrap }}

                </div>
            </div>

            <div class="row">
                <div class="col-md-6">
                    <h2 class="background"><span>Administration</span></h2>

                    {{ form.administration_number_of_intercepts_last_month|bootstrap }}
                    {{ form.administration_number_of_intercepts_last_month_multiplier|bootstrap }}
                    {{ form.administration_number_of_intercepts_last_month_adder|bootstrap }}
                    {{ form.administration_number_of_meetings_per_month|bootstrap }}
                    {{ form.administration_number_of_meetings_per_month_multiplier|bootstrap }}
                    {{ form.administration_booth|bootstrap }}
                    {{ form.administration_booth_amount|bootstrap }}
                    {{ form.administration_registration|bootstrap }}
                    {{ form.administration_registration_amount|bootstrap }}
                </div>
                <div class="col-md-6">
                    <table class="table table-bordered table-hover">
                        <thead>
                            <tr>
                                <th colspan="3" class="text-center">Border Monitoring Station</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>Salaries</td>
                                <td width="25%"></td>
                                <td class="active" width="25%"></td>
                            </tr>
                            <tr>
                                <td>Comm.</td>
                                <td></td>
                                <td class="active"></td>
                            </tr>
                            <tr>
                                <td>Travel</td>
                                <td></td>
                                <td class="active"></td>
                            </tr>
                            <tr>
                                <td>Admin.</td>
                                <td></td>
                                <td class="active"></td>
                            </tr>
                            <tr>
                                <td>Medical</td>
                                <td></td>
                                <td class="active"></td>
                            </tr>
                            <tr>
                                <td>Misc.</td>
                                <td></td>
                                <td class="active"></td>
                            </tr>
                            <tr>
                                <td class="text-right"><b>TOTAL</b></td>
                                <td colspan="2"></td>
                            </tr>
                        </tbody>
                        <thead>
                            <tr class="warning">
                                <th colspan="3" class="text-center">Safe Houses</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td class="warning">Shelter</td>
                                <td class="warning"><p data-bind="text: shelterTotal"></p></td>
                                <td class="active"></td>
                            </tr>
                            <tr>
                                <td class="warning">Food</td>
                                <td class="warning"><p data-bind="text: foodTotal"></p></td>
                                <td class="active"></td>
                            </tr>
                            <tr class="warning">
                                <td class="text-right"><b>TOTAL</b></td>
                                <td colspan="2"></td>
                            </tr>
                        </tbody>
                        <tbody>
                            <tr>
                                <td class="text-center"><b>Awareness</b></td>
                                <td colspan="2"></td>
                            </tr>
                            <tr>
                                <td class="text-center"><b>Supplies</b></td>
                                <td colspan="2"></td>
                            </tr>
                            <tr>
                                <td class="text-center"><b>STATION TOTAL</b></td>
                                <td colspan="2"></td>
                            </tr>
                            <tr>
                                <td class="text-center">Last month's TOTAL</td>
                                <td colspan="2"></td>
                            </tr>
                        </tbody>

                    </table>
                </div>
            </div>

            <div class="row">
                <div class="col-md-6">
                    <h2 class="background"><span>Medical</span></h2>
                    {{ form.medical_last_months_expense|bootstrap }}
                </div>
            </div>

            <div class="row">
                <div class="col-md-6">
                    <h2 class="background"><span>Miscellaneous</span></h2>
                    {{ form.miscellaneous_number_of_intercepts_last_month|bootstrap }}
                    {{ form.miscellaneous_number_of_intercepts_last_month_multiplier|bootstrap }}

                </div>
            </div>

        </div>

     <script type='text/javascript'>
         function shelterViewModel() {
             //Shelter Section
             this.firstName = "TOTAL";
             this.shelterRent = ko.observable(0);
             this.shelterWater = ko.observable(0);
             this.shelterElectricity = ko.observable(0);
             this.shelterCheckboxTotal = ko.pureComputed(function(){
                 var totalAmount = 0;
                 if(this.shelterStartupBool()) {
                     totalAmount += parseFloat(this.shelterStartupAmount());
                 }
                 if(this.shelterTwoBool()) {
                     totalAmount += parseFloat(this.shelterTwoAmount());
                 }
                 return totalAmount;
             }, this);

             this.shelterTotal = ko.pureComputed(function(){
                return parseFloat(this.shelterRent()) + parseFloat(this.shelterWater()) + parseFloat(this.shelterElectricity()) + parseFloat(this.shelterCheckboxTotal());
             }, this);
             this.shelterStartupBool = ko.observable(false);
             this.shelterStartupAmount = ko.observable(71800);
             this.shelterTwoBool = ko.observable(false);
             this.shelterTwoAmount = ko.observable(36800);

             //Food and Gas Section
             this.foodGasNumberOfGirls = ko.observable(0);
             this.foodGasMultiplierBefore = ko.observable(100);
             this.foodGasMultiplierAfter = ko.observable(3);
             this.limboNumberOfGirls = ko.observable(0);
             this.limboMultiplier = ko.observable(100);
             this.limboNumberOfDays = ko.observable(1);
             this.foodGasInterceptedGirls = ko.pureComputed(function(){
                 return parseFloat(this.foodGasMultiplierBefore()) * parseFloat(this.foodGasNumberOfGirls()) * parseFloat(this.foodGasMultiplierAfter());
             }, this);
             this.foodGasLimboGirls = ko.pureComputed(function(){
                 return parseFloat(this.limboMultiplier()) * parseFloat(this.limboNumberOfGirls()) * parseFloat(this.limboNumberOfDays());
             }, this);
             this.foodTotal = ko.computed(function() {
                 return parseFloat(this.foodGasInterceptedGirls()) + parseFloat(this.foodGasLimboGirls());
             }, this);

             //Communication section
             this.commChairBool = ko.observable(false);
             this.commChairAmount = ko.observable(1000);
             this.commManagerBool = ko.observable(false);
             this.commManagerAmount = ko.observable(1000);
             this.commNumberOfStaffWt = ko.observable(0);
             this.commNumberOfStaffWtMultiplier = ko.observable(100);
             this.commEachStaffWt = ko.observable(0);
             this.commEachStaffWtMultiplier = ko.observable(300);
             this.commManagerTotal = ko.computed(function() {
                 var amount = 0;

                 if(this.commChairBool()) {
                     amount += parseFloat(this.commChairAmount());
                 }
                 if(this.commManagerBool()) {
                     amount += parseFloat(this.commChairAmount());
                 }
                 return amount;
             }, this);

             this.commNumberOfStaffTotal = ko.computed(function() {
                 return parseFloat(this.commNumberOfStaffWt()) * parseFloat(this.commNumberOfStaffWtMultiplier());
             }, this);

             this.commEachStaffTotal = ko.computed(function() {
                 return parseFloat(this.commEachStaffWt()) * parseFloat(this.commEachStaffWtMultiplier());
             }, this);

             this.commTotal = ko.computed(function() {
                 return parseFloat(this.commManagerTotal()) + parseFloat(this.commNumberOfStaffTotal()) + parseFloat(this.commEachStaffTotal());
             }, this);
         }

         ko.applyBindings(new shelterViewModel());

     </script>
     </form>



        <div class="row">

            <input type="submit" class="pull-right btn btn-primary navbar-btn btn-lg" value="Create" />
    </div>
     </form>




    {% endblock %}
{% endblock %}